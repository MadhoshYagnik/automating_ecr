### Prerequisites
Before configuring your GitHub Actions workflow for Amazon ECR and ECS, ensure the following steps are completed:

1. **Create Amazon ECR Repository**:
   Create an ECR repository via AWS CLI:
   ```bash
   aws ecr create-repository \
       --repository-name MY_ECR_REPOSITORY \
       --region MY_AWS_REGION
   ```
   Use the repository name (`MY_ECR_REPOSITORY`) for the `ECR_REPOSITORY` variable and set the AWS region (`MY_AWS_REGION`) for the `AWS_REGION` variable in the workflow.

2. **Set Up Amazon ECS**:
   Follow the steps in the Amazon ECS documentation to create a task definition, cluster, and service. Note the names used for the ECS service and cluster to set for `ECS_SERVICE` and `ECS_CLUSTER` variables in the workflow.

3. **Store ECS Task Definition**:
   Store the ECS task definition as a JSON file in your repository, ensuring its format aligns with the output generated by `aws ecs register-task-definition --generate-cli-skeleton`. Set the `ECS_TASK_DEFINITION` variable in the workflow to the JSON file path.

4. **GitHub Actions Secrets**:
   Create GitHub Actions secrets (`AWS_ACCESS_KEY_ID` and `AWS_SECRET_ACCESS_KEY`) to store your Amazon IAM access key.

5. **IAM Policies**:
   Refer to the action documentation for recommended IAM policies for the IAM user and guidelines on handling access key credentials.

### Workflow Configuration
After completing the prerequisites, proceed with creating the workflow:

```yaml
# GitHub Actions Workflow
name: Deploy to Amazon ECS

on:
  push:
    branches:
      - main

# Environment variables
env:
  AWS_REGION: MY_AWS_REGION                   # Your AWS region
  ECR_REPOSITORY: MY_ECR_REPOSITORY           # Your ECR repository name
  ECS_SERVICE: MY_ECS_SERVICE                 # Your ECS service name
  ECS_CLUSTER: MY_ECS_CLUSTER                 # Your ECS cluster name
  ECS_TASK_DEFINITION: MY_ECS_TASK_DEFINITION # Path to your ECS task definition JSON file
  CONTAINER_NAME: MY_CONTAINER_NAME           # Your container name

jobs:
  deploy:
    name: Deploy
    runs-on: ubuntu-latest
    environment: production

    steps:
      # Step 1: Checkout code
      - name: Checkout
        uses: actions/checkout@v4

      # Step 2: Configure AWS credentials
      - name: Configure AWS credentials
        uses: aws-actions/configure-aws-credentials@0e613a0980cbf65ed5b322eb7a1e075d28913a83
        with:
          aws-access-key-id: ${{ secrets.AWS_ACCESS_KEY_ID }}
          aws-secret-access-key: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
          aws-region: ${{ env.AWS_REGION }}

      # Step 3: Login to Amazon ECR
      - name: Login to Amazon ECR
        uses: aws-actions/amazon-ecr-login@62f4f872db3836360b72999f4b87f1ff13310f3a

      # ... (Other steps remain the same)
```

Ensure to replace placeholders (`MY_AWS_REGION`, `MY_ECR_REPOSITORY`, `MY_ECS_SERVICE`, `MY_ECS_CLUSTER`, `MY_ECS_TASK_DEFINITION`, `MY_CONTAINER_NAME`) with your actual values. This workflow builds a container image, updates the ECS task definition, and deploys it to ECS. Adjust variables and configuration based on your specific setup.
